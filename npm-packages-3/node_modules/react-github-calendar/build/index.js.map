{"version":3,"file":"index.js","sources":["../src/lib.ts","../src/index.tsx"],"sourcesContent":["import { Props } from './index';\nimport { Activity } from './types';\n\nexport const transformData = (\n  data: Array<Activity>,\n  transformFn?: Props['transformData'],\n): Array<Activity> => {\n  if (typeof transformFn !== 'function') {\n    return data;\n  }\n\n  const transformedData = transformFn(data);\n\n  if (!Array.isArray(transformedData)) {\n    throw Error(`Passed function transformData must return a list of Day objects.`);\n  }\n\n  if (transformedData.length > 0) {\n    const testObj = transformedData[0];\n\n    if (typeof testObj.count !== 'number' || testObj.count < 0) {\n      throw Error(`Required property \"count: number\" missing or invalid. Got: ${testObj.count}`);\n    }\n\n    if (!/\\d{4}-\\d{2}-\\d{2}/.test(testObj.date)) {\n      throw Error(`Required property \"date: YYYY-MM-DD\" missing or invalid. Got: ${testObj.date}`);\n    }\n\n    if (typeof testObj.level !== 'number' || testObj.level < 0 || testObj.level > 4) {\n      throw Error(\n        `Required property \"level: 0 | 1 | 2 | 3 | 4\" missing or invalid: Got: ${testObj.level}.`,\n      );\n    }\n  }\n\n  return transformedData;\n};\n","'use client';\n\nimport React, { forwardRef, useCallback, useEffect, useState } from 'react';\nimport Calendar, {\n  Skeleton,\n  ThemeInput,\n  type Props as ActivityCalendarProps,\n} from 'react-activity-calendar';\nimport { transformData } from './lib';\nimport { Activity, ApiErrorResponse, ApiResponse, Year } from './types';\n\nexport interface Props extends Omit<ActivityCalendarProps, 'data'> {\n  username: string;\n  errorMessage?: string;\n  throwOnError?: boolean;\n  transformData?: (data: Array<Activity>) => Array<Activity>;\n  transformTotalCount?: boolean;\n  year?: Year;\n}\n\nasync function fetchCalendarData(username: string, year: Year): Promise<ApiResponse> {\n  const apiUrl = 'https://github-contributions-api.jogruber.de/v4/';\n  const response = await fetch(`${apiUrl}${username}?y=${year}`);\n  const data = (await response.json()) as ApiResponse | ApiErrorResponse;\n\n  if (!response.ok) {\n    throw Error(\n      `Fetching GitHub contribution data for \"${username}\" failed: ${(data as ApiErrorResponse).error}`,\n    );\n  }\n\n  return data as ApiResponse;\n}\n\nconst GitHubCalendar = forwardRef<HTMLElement, Props>(\n  (\n    {\n      username,\n      year = 'last',\n      labels,\n      transformData: transformFn,\n      transformTotalCount = true,\n      throwOnError = false,\n      errorMessage = `Error â€“ Fetching GitHub contribution data for \"${username}\" failed.`,\n      ...props\n    },\n    ref,\n  ) => {\n    const [data, setData] = useState<ApiResponse | null>(null);\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState<Error | null>(null);\n\n    const fetchData = useCallback(() => {\n      setLoading(true);\n      setError(null);\n      fetchCalendarData(username, year)\n        .then(setData)\n        .catch((err: unknown) => {\n          if (err instanceof Error) {\n            setError(err);\n          }\n        })\n        .finally(() => {\n          setLoading(false);\n        });\n    }, [username, year]);\n\n    useEffect(fetchData, [fetchData]);\n\n    // React error boundaries can't handle asynchronous code, so rethrow.\n    if (error) {\n      if (throwOnError) {\n        throw error;\n      } else {\n        return <div>{errorMessage}</div>;\n      }\n    }\n\n    if (loading || !data) {\n      return <Skeleton {...props} loading />;\n    }\n\n    const theme = props.theme ?? gitHubTheme;\n\n    const defaultLabels = {\n      totalCount: `{{count}} contributions in ${year === 'last' ? 'the last year' : '{{year}}'}`,\n    };\n\n    const totalCount = year === 'last' ? data.total['lastYear'] : data.total[year];\n\n    return (\n      <Calendar\n        data={transformData(data.contributions, transformFn)}\n        labels={Object.assign({}, defaultLabels, labels)}\n        ref={ref}\n        totalCount={transformFn && transformTotalCount ? undefined : totalCount}\n        {...props}\n        theme={theme}\n        loading={Boolean(props.loading) || loading}\n        maxLevel={4}\n      />\n    );\n  },\n);\n\nGitHubCalendar.displayName = 'GitHubCalendar';\n\nconst gitHubTheme = {\n  light: ['#ebedf0', '#9be9a8', '#40c463', '#30a14e', '#216e39'],\n  dark: ['#161b22', '#0e4429', '#006d32', '#26a641', '#39d353'],\n} satisfies ThemeInput;\n\nexport default GitHubCalendar;\n"],"names":["transformData","data","transformFn","transformedData","Array","isArray","Error","length","testObj","count","test","date","level","fetchCalendarData","username","year","apiUrl","response","fetch","json","ok","error","GitHubCalendar","forwardRef","labels","transformTotalCount","throwOnError","errorMessage","props","ref","setData","useState","loading","setLoading","setError","fetchData","useCallback","then","catch","err","finally","useEffect","React","createElement","Skeleton","_extends","theme","gitHubTheme","defaultLabels","totalCount","total","Calendar","contributions","Object","assign","undefined","Boolean","maxLevel","displayName","light","dark"],"mappings":"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"}